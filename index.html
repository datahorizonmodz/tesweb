<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>DATZON Web App</title>
    <style>
        :root {
            /* Dark Theme (Telegram Inspired) - Default */
            --bg: #0e1621;
            --header-bg: rgba(23, 33, 43, 0.85);
            --card-bg: rgba(24, 37, 51, 0.7);
            --card-solid: #182533;
            --text-main: #f5f5f5;
            --text-muted: #8a9ba8;
            --accent: #2b5278;
            --accent-light: #40a7e3;
            --glass-border: rgba(255, 255, 255, 0.08);
            --nav-bg: rgba(23, 33, 43, 0.9);
            --shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
            --glow: 0 0 15px rgba(64, 167, 227, 0.3);
            --modal-overlay: rgba(14, 22, 33, 0.8);
            
            /* Theme Dependent Text/Icons */
            --filter-active-text: #ffffff;
            --nav-active-icon: #ffffff;
        }

        [data-theme="light"] {
            /* Light Theme */
            --bg: #f5f5f5;
            --header-bg: rgba(255, 255, 255, 0.85);
            --card-bg: rgba(255, 255, 255, 0.7);
            --card-solid: #ffffff;
            --text-main: #222222;
            --text-muted: #707579;
            --accent: #e4f1f9;
            --accent-light: #40a7e3;
            --glass-border: rgba(0, 0, 0, 0.08);
            --nav-bg: rgba(255, 255, 255, 0.9);
            --shadow: 0 8px 32px rgba(0, 0, 0, 0.08);
            --glow: 0 0 15px rgba(64, 167, 227, 0.4);
            --modal-overlay: rgba(255, 255, 255, 0.6);
            
            /* Theme Dependent Text/Icons */
            --filter-active-text: #222222;
            --nav-active-icon: #222222;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--bg);
            color: var(--text-main);
            transition: background-color 0.4s ease, color 0.4s ease;
            display: flex;
            justify-content: center;
        }

        /* Mobile App Container Constraint */
        .app-container {
            width: 100%;
            max-width: 480px;
            min-height: 100vh;
            position: relative;
            background-color: var(--bg);
            box-shadow: 0 0 50px rgba(0,0,0,0.5);
            overflow-x: hidden;
            transition: background-color 0.4s ease;
        }

        /* GLASSMORPHISM UTILITY */
        .glass {
            background: var(--card-bg);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid var(--glass-border);
            box-shadow: var(--shadow);
        }

        /* HEADER */
        header {
            position: fixed;
            top: 0;
            width: 100%;
            max-width: 480px;
            height: 60px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 16px;
            z-index: 100;
            background: var(--header-bg);
            backdrop-filter: blur(15px);
            -webkit-backdrop-filter: blur(15px);
            border-bottom: 1px solid var(--glass-border);
        }

        .header-profile {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            object-fit: cover;
            border: 2px solid var(--accent-light);
        }

        .header-title {
            font-size: 1.1rem;
            font-weight: 700;
            letter-spacing: 1px;
        }

        .theme-btn {
            background: none;
            border: none;
            color: var(--text-main);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            transition: transform 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .theme-btn:active {
            transform: scale(0.8) rotate(45deg);
        }

        /* MAIN CONTENT */
        main {
            padding: 80px 16px 100px 16px;
        }

        .page {
            display: none;
            animation: fadeInSlideUp 0.5s ease forwards;
        }

        .page.active {
            display: block;
        }

        @keyframes fadeInSlideUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* IMPORTANT MESSAGE CARD */
        .msg-card {
            border-radius: 16px;
            padding: 16px;
            margin-bottom: 24px;
            line-height: 1.5;
            font-size: 0.95rem;
            color: var(--text-main);
            position: relative;
            overflow: hidden;
            animation: fadeInSlideUp 0.6s ease forwards;
        }
        
        .msg-card::before {
            content: '';
            position: absolute;
            top: 0; left: 0;
            width: 4px; height: 100%;
            background: var(--accent-light);
        }

        /* MOVING FILTER BAR */
        .filter-container {
            overflow-x: auto;
            white-space: nowrap;
            margin-bottom: 24px;
            position: relative;
            border-radius: 20px;
            scrollbar-width: none; /* Firefox */
            -webkit-overflow-scrolling: touch;
        }

        .filter-container::-webkit-scrollbar {
            display: none; /* Chrome, Safari, Edge */
        }

        .filter-track {
            display: inline-flex;
            gap: 10px;
            padding-right: 16px;
            width: max-content;
        }

        .filter-tag {
            background: var(--card-solid);
            border: 1px solid var(--glass-border);
            color: var(--text-muted);
            padding: 8px 20px;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .filter-tag.active {
            background: var(--accent);
            color: var(--filter-active-text);
            border-color: var(--accent-light);
            box-shadow: var(--glow);
        }

        /* APP & PRODUCT CARDS */
        .card-list {
            display: flex;
            flex-direction: column;
            gap: 16px;
        }

        .item-card {
            display: flex;
            align-items: center;
            padding: 12px;
            border-radius: 16px;
            cursor: pointer;
            transition: transform 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275), box-shadow 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .item-card:hover, .item-card:active {
            transform: translateY(-4px) scale(1.02);
            box-shadow: var(--glow);
            border-color: var(--accent-light);
        }

        .item-icon {
            width: 50px;
            height: 50px;
            border-radius: 12px;
            object-fit: cover;
            margin-right: 16px;
            background: var(--bg);
        }

        .item-info {
            flex: 1;
        }

        .item-title {
            font-size: 1.05rem;
            font-weight: 600;
            margin-bottom: 4px;
        }

        .item-date {
            font-size: 0.8rem;
            color: var(--text-muted);
        }

        .item-action {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: rgba(64, 167, 227, 0.1);
            color: var(--accent-light);
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }

        .item-card:hover .item-action {
            background: var(--accent-light);
            color: #fff;
        }

        /* PROFILE PAGE */
        .profile-header {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .profile-avatar {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            border: 3px solid var(--accent-light);
            margin-bottom: 16px;
            box-shadow: var(--glow);
        }

        .profile-title {
            font-size: 1.5rem;
            font-weight: 700;
        }

        .social-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            width: 100%;
            padding: 14px;
            border-radius: 12px;
            margin-bottom: 12px;
            background: var(--card-solid);
            color: var(--text-main);
            text-decoration: none;
            font-weight: 600;
            border: 1px solid var(--glass-border);
            transition: all 0.3s ease;
        }

        .social-btn:hover {
            transform: scale(1.02);
            box-shadow: var(--glow);
            border-color: var(--accent-light);
        }

        /* BOTTOM NAVIGATION */
   .bottom-nav-wrapper {
    position: fixed;
    bottom: 18px;
    left: 50%;
    transform: translateX(-50%);
    z-index: 9999;
    pointer-events: auto;
}

.bottom-nav {
    width: min(92vw, 300px);
    height: 64px;

    display: flex;
    align-items: center;
    justify-content: space-between;

    padding: 0 16px;
    border-radius: 32px;

    background: var(--nav-bg);
    backdrop-filter: blur(14px);

    animation: floatIn 0.8s cubic-bezier(0.22, 1, 0.36, 1);
    animation-fill-mode: both;
}

        .nav-indicator {
    position: absolute;
    height: 44px;
    width: 72px;              /* FIXED WIDTH */
    background: var(--accent);
    border-radius: 22px;
    z-index: 0;
    transition: all 0.35s cubic-bezier(0.4, 0, 0.2, 1);
    opacity: 0;
}

        .nav-btn {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            height: 100%;
            background: none;
            border: none;
            color: var(--text-muted);
            cursor: pointer;
            z-index: 1;
            transition: color 0.3s ease, flex 0.4s ease, opacity 0.4s ease;
        }

        .nav-btn.active {
            color: var(--nav-active-icon);
        }

        .nav-btn svg {
            width: 24px;
            height: 24px;
            transition: transform 0.3s ease;
        }

        .nav-btn.active svg {
            transform: scale(1.15);
        }

        .nav-profile-img {
            width: 26px;
            height: 26px;
            border-radius: 50%;
            border: 2px solid transparent;
            transition: border-color 0.3s;
        }

        .nav-btn.active .nav-profile-img {
            border-color: var(--nav-active-icon);
        }


/* SEARCH INTERACTION */
        .search-wrapper {
            width: 40px;
            height: 40px;
            border-radius: 999px;
            display: flex;
            align-items: center;
            justify-content: flex-start; /* Keeps the icon anchored left */
            overflow: hidden;
            background: transparent;
            transition: flex 0.4s ease, width 0.4s ease, background 0.4s ease, padding 0.4s ease;
            margin: 0;
        }

        .search-icon-btn,
        .search-close {
            width: 40px;
            height: 40px;
            background: none;
            border: none;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
            color: var(--text-muted); /* Fixes dark mode color issue */
            cursor: pointer;
            transition: color 0.3s ease;
        }

        /* Fixes icon sizing to perfectly match other nav buttons */
        .search-icon-btn svg,
        .search-close svg {
            width: 24px;
            height: 24px;
            transition: transform 0.3s ease;
        }

        /* Uses width/opacity instead of display: none for smooth expansion */
        .search-input {
            flex: 1;
            width: 0;
            opacity: 0;
            background: transparent;
            border: none;
            outline: none;
            font-size: 14px;
            color: var(--text-main);
            pointer-events: none;
            transition: width 0.4s ease, opacity 0.4s ease;
            padding: 0;
        }

        .search-input::placeholder {
            color: var(--text-muted);
        }

        .search-close {
            width: 0;
            opacity: 0;
            pointer-events: none;
            transform: scale(0.5);
            transition: all 0.4s ease;
        }

        /* Nav State when Searching */
        .nav-search-active .nav-btn[data-target] {
            flex: 0;
            width: 0;
            opacity: 0;
            pointer-events: none;
            padding: 0;
            margin: 0;
            overflow: hidden; /* Ensures buttons collapse fully */
        }

        #main-nav.nav-search-active .search-wrapper {
            flex: 1;
            width: 100%;
            background: var(--card-solid);
            border: 1px solid var(--glass-border);
            padding: 0 4px; /* Creates a nice pill shape */
        }

        #main-nav.nav-search-active .search-input {
            width: 100%;
            opacity: 1;
            pointer-events: all;
            padding: 0 8px;
        }

        #main-nav.nav-search-active .search-close {
            width: 40px;
            opacity: 1;
            pointer-events: all;
            transform: scale(1);
        }

        #main-nav.nav-search-active .search-icon-btn {
            color: var(--nav-active-icon); /* Highlights magnifier when active */
        }

        .nav-search-active .nav-indicator {
            opacity: 0 !important;
            width: 0 !important;
        }


        /* PRODUCT MODAL */
        .modal-overlay {
            position: fixed;
            inset: 0;
            background: var(--modal-overlay);
            backdrop-filter: blur(8px);
            -webkit-backdrop-filter: blur(8px);
            z-index: 200;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.4s ease;
            padding: 20px;
        }

        .modal-overlay.show {
            opacity: 1;
            pointer-events: all;
        }

        .modal-content {
            width: 100%;
            max-width: 400px;
            border-radius: 24px;
            padding: 24px;
            position: relative;
            transform: translateY(50px) scale(0.95);
            transition: transform 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            max-height: 85vh;
            overflow-y: auto;
        }

        .modal-overlay.show .modal-content {
            transform: translateY(0) scale(1);
        }

        .modal-close {
            position: absolute;
            top: 16px;
            right: 16px;
            background: rgba(255, 255, 255, 0.1);
            border: none;
            width: 32px;
            height: 32px;
            border-radius: 50%;
            color: var(--text-main);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: background 0.3s;
        }
        
        .modal-close:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .modal-header {
            text-align: center;
            margin-bottom: 20px;
        }

        .modal-icon {
            width: 80px;
            height: 80px;
            border-radius: 18px;
            margin-bottom: 12px;
            box-shadow: var(--shadow);
        }

        .modal-title {
            font-size: 1.4rem;
            margin-bottom: 5px;
        }

        .modal-prices {
            color: var(--accent-light);
            font-weight: 600;
            margin-bottom: 15px;
        }

        .modal-section {
            margin-bottom: 16px;
        }
        
        .modal-section h4 {
            color: var(--text-muted);
            margin-bottom: 6px;
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .modal-section p {
            font-size: 0.95rem;
            line-height: 1.5;
            color: var(--text-main);
        }

        .wa-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            background: #25D366;
            color: #fff;
            text-decoration: none;
            padding: 14px;
            border-radius: 12px;
            font-weight: bold;
            font-size: 1.05rem;
            margin-top: 20px;
            box-shadow: 0 4px 15px rgba(37, 211, 102, 0.4);
            transition: transform 0.3s;
        }

        .wa-btn:active {
            transform: scale(0.96);
        }

        /* NO RESULTS */
        .no-results {
            text-align: center;
            padding: 40px 20px;
            color: var(--text-muted);
            display: none;
        }
@keyframes floatIn {
    0% {
        transform: translateY(40px);
        opacity: 0;
    }
    60% {
        transform: translateY(-6px);
        opacity: 1;
    }
    80% {
        transform: translateY(4px);
    }
    100% {
        transform: translateY(0);
        opacity: 1;
    }
}

/* --- DYNAMIC ISLAND MUSIC STYLES --- */
.dynamic-island {
    position: fixed;
    top: 20px;
    left: 50%;
    transform: translate(-50%, -150%);
    z-index: 10000;
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 8px 16px;
    border-radius: 50px;
    opacity: 0;
    transition: transform 0.6s cubic-bezier(0.34, 1.56, 0.64, 1), opacity 0.4s ease;
    pointer-events: none;
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
}

.dynamic-island.active {
    transform: translate(-50%, 0);
    opacity: 1;
    pointer-events: auto;
}

.di-btn {
    background: rgba(64, 167, 227, 0.15);
    border: none;
    color: var(--accent-light);
    width: 36px;
    height: 36px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: all 0.3s ease;
}

.di-btn:hover, .di-btn:active {
    background: var(--accent-light);
    color: #fff;
    transform: scale(1.05);
}

.di-info {
    font-size: 0.9rem;
    font-weight: 600;
    color: var(--text-main);
    min-width: 80px;
    text-align: center;
    letter-spacing: 0.5px;
}

.di-visualizer {
    display: flex;
    align-items: center;
    gap: 4px;
    height: 18px;
    padding-right: 8px;
}

.di-visualizer .bar {
    width: 3px;
    background: var(--accent-light);
    border-radius: 3px;
    animation: audioBar 0.8s ease-in-out infinite alternate;
}

.di-visualizer .bar:nth-child(1) { height: 30%; animation-delay: 0.0s; }
.di-visualizer .bar:nth-child(2) { height: 100%; animation-delay: 0.2s; }
.di-visualizer .bar:nth-child(3) { height: 60%; animation-delay: 0.4s; }
.di-visualizer .bar:nth-child(4) { height: 80%; animation-delay: 0.1s; }

/* Pauses the CSS animation smoothly when music stops */
.di-visualizer.paused .bar {
    animation-play-state: paused;
    height: 4px !important;
    transition: height 0.3s ease;
}

@keyframes audioBar {
    0% { height: 20%; }
    100% { height: 100%; }
}


    </style>
</head>
<body>

<div class="app-container">

    <!-- HEADER -->
    <header>
        <img src="https://ui-avatars.com/api/?name=Datzon&background=2b5278&color=fff&rounded=true" alt="Profile" class="header-profile">
        <div class="header-title">DATZON</div>
        <button class="theme-btn" id="theme-btn" aria-label="Toggle Theme">
            <!-- Default Moon for Dark Mode -->
            <svg id="theme-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                <path d="M3 3l1 2 2 1-2 1-1 2-1-2-2-1 2-1z" fill="currentColor"/>
            </svg>
        </button>
    </header>

    <!-- MAIN CONTENT -->
    <main>
        <!-- HOME PAGE -->
        <section id="page-home" class="page active">
            <div class="msg-card glass">
                This website shares mod applications for free.<br>
                We also provide DATZON STORE, offering original premium products at affordable prices.<br>
                You can also find my profile, social media, and other resources here.<br><br>
                Thank you for continuously supporting DATZON.
            </div>

            <div class="filter-container" id="filter-container">
                <div class="filter-track" id="filter-track">
                    <!-- Filters will be injected by JS to allow infinite looping -->
                </div>
            </div>

            <div class="card-list" id="home-list">
                <!-- App items will be injected here dynamically -->
            </div>
            <div class="no-results" id="home-no-results">No applications found.</div>
        </section>

        <!-- STORE PAGE -->
        <section id="page-store" class="page">
            <div class="msg-card glass">
                DATZON STORE provides original premium products only.<br>
                No mod applications are sold here.<br>
                We offer premium apps, social media services, and premium tutorials.<br><br>
                Trusted by many customers.
            </div>

            <div class="card-list" id="store-list">
                <!-- Store items will be injected here dynamically -->
            </div>
            <div class="no-results" id="store-no-results">No products found.</div>
        </section>

        <!-- PROFILE PAGE -->
        <section id="page-profile" class="page">
            <div class="profile-header">
                <img src="https://ui-avatars.com/api/?name=Datzon&background=2b5278&color=fff&size=200" alt="Avatar" class="profile-avatar">
                <h2 class="profile-title">DATA HORIZON</h2>
                <p style="color: var(--text-muted); margin-top: 5px;">(DATZON)</p>
            </div>
            
            <div class="card-list">
                <!-- Social buttons will be injected here dynamically -->
            </div>
        </section>
    </main>

    <!-- BOTTOM FLOATING NAV -->
    <div class="bottom-nav-wrapper">
        <nav class="bottom-nav glass" id="main-nav">
            <div class="nav-indicator" id="nav-indicator"></div>
            
            <button class="nav-btn active" data-target="page-home" aria-label="Home">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
                    <polyline points="9 22 9 12 15 12 15 22"></polyline>
                </svg>
            </button>
            
            <div class="search-wrapper" id="search-wrapper">
               <button class="search-icon-btn" id="search-trigger" aria-label="Search">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <circle cx="11" cy="11" r="8"></circle>
                        <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
                    </svg>
                </button>
                <input type="text" id="search-input" class="search-input" placeholder="Search DATZON...">
                <button class="search-close" id="search-close" aria-label="Close Search">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <line x1="18" y1="6" x2="6" y2="18"></line>
                        <line x1="6" y1="6" x2="18" y2="18"></line>
                    </svg>
                </button>
            </div>

            <button class="nav-btn" data-target="page-store" aria-label="Store">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <circle cx="9" cy="21" r="1"></circle>
                    <circle cx="20" cy="21" r="1"></circle>
                    <path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"></path>
                </svg>
            </button>

            <button class="nav-btn" data-target="page-profile" aria-label="Profile">
                <img src="https://ui-avatars.com/api/?name=Datzon&background=2b5278&color=fff&rounded=true" alt="User" class="nav-profile-img">
            </button>
        </nav>
    </div>

    <!-- PRODUCT DETAIL MODAL -->
    <div class="modal-overlay" id="product-modal">
        <div class="modal-content glass">
            <button class="modal-close" id="close-modal">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <line x1="18" y1="6" x2="6" y2="18"></line>
                    <line x1="6" y1="6" x2="18" y2="18"></line>
                </svg>
            </button>
            
            <div class="modal-header">
                <img src="" id="modal-img" class="modal-icon" alt="Product Icon">
                <h2 class="modal-title" id="modal-title">Product Name</h2>
                <div class="modal-prices" id="modal-prices"></div>
            </div>

            <div class="modal-section">
                <h4>Description</h4>
                <p id="modal-desc">Product description goes here.</p>
            </div>

            <a href="#" class="wa-btn" id="modal-wa-btn">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M21 11.5a8.38 8.38 0 0 1-.9 3.8 8.5 8.5 0 0 1-7.6 4.7 8.38 8.38 0 0 1-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 0 1-.9-3.8 8.5 8.5 0 0 1 4.7-7.6 8.38 8.38 0 0 1 3.8-.9h.5a8.48 8.48 0 0 1 8 8v.5z"></path>
                </svg>
                Order via WhatsApp
            </a>
        </div>
    </div>

</div>

<div id="dynamic-island" class="dynamic-island glass">
    <button id="di-play-pause" class="di-btn" aria-label="Play/Pause">
        <svg id="di-icon-pause" width="18" height="18" viewBox="0 0 24 24" fill="currentColor" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <rect x="6" y="4" width="4" height="16"></rect>
            <rect x="14" y="4" width="4" height="16"></rect>
        </svg>
        <svg id="di-icon-play" style="display:none;" width="18" height="18" viewBox="0 0 24 24" fill="currentColor" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <polygon points="5 3 19 12 5 21 5 3"></polygon>
        </svg>
    </button>
    
    <div class="di-info">
        <span class="di-title">music1.mp3</span>
    </div>
    
    <div id="di-visualizer" class="di-visualizer">
        <div class="bar"></div>
        <div class="bar"></div>
        <div class="bar"></div>
        <div class="bar"></div>
    </div>
</div>


<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
    import { getAuth, signInAnonymously, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
    import { getFirestore, collection, onSnapshot } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

    // --- Firebase Configuration & Initialization ---
    const firebaseConfig = {
      apiKey: "AIzaSyCaCVfxYTP3IvR6Jrh3mM0GBsvYKJRjRe4",
      authDomain: "datzon-web.firebaseapp.com",
      projectId: "datzon-web",
      storageBucket: "datzon-web.firebasestorage.app",
      messagingSenderId: "310892115798",
      appId: "1:310892115798:web:a03fb9d2b2137933b948f7"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    let dataLoaded = false;
    const loadData = () => {
        if (dataLoaded) return;
        dataLoaded = true;

        // Subscribe to Apps collection
        onSnapshot(collection(db, 'apps'), snapshot => {
            renderApps(snapshot.docs.map(doc => ({id: doc.id, ...doc.data()})));
        }, err => console.error("Error loading Apps (Check Firestore Rules):", err));

        // Subscribe to Products collection
        onSnapshot(collection(db, 'products'), snapshot => {
            renderProducts(snapshot.docs.map(doc => ({id: doc.id, ...doc.data()})));
        }, err => console.error("Error loading Products (Check Firestore Rules):", err));

        // Subscribe to Socials collection
        onSnapshot(collection(db, 'profiles'), snapshot => {
            renderSocials(snapshot.docs.map(doc => ({id: doc.id, ...doc.data()})));
        }, err => console.error("Error loading Socials (Check Firestore Rules):", err));
    };

    const initAuth = async () => {
        try {
            await signInAnonymously(auth);
            loadData();
        } catch (err) {
            console.warn("Firebase Auth Warning: Anonymous sign-in is disabled or restricted. Attempting to fetch public data without authentication...", err.message);
            loadData(); // Attempt to load data even if auth fails
        }
    };

    onAuthStateChanged(auth, user => {
        if (user) loadData();
    });

    // Start Authentication
    initAuth();

    // --- Data Configuration (Filters) ---
    const filterCategories = ['Popular', 'Editing', 'Enhancer', 'Music', 'Film', 'Anime'];
    
    // --- DOM Elements ---
    const themeBtn = document.getElementById('theme-btn');
    const themeIcon = document.getElementById('theme-icon');
    const htmlTag = document.documentElement;
    
    const navBtns = document.querySelectorAll('.nav-btn[data-target]');
    const pages = document.querySelectorAll('.page');
    const navIndicator = document.getElementById('nav-indicator');
    const mainNav = document.getElementById('main-nav');
    
    const searchTrigger = document.getElementById('search-trigger');
    const searchClose = document.getElementById('search-close');
    const searchInput = document.getElementById('search-input');
    const searchWrapper = document.getElementById('search-wrapper');
    
    const filterContainer = document.getElementById('filter-container');
    const filterTrack = document.getElementById('filter-track');
    
    const modal = document.getElementById('product-modal');
    const closeModalBtn = document.getElementById('close-modal');

    // Ensure list containers are perfectly empty for dynamic injection
    document.getElementById('home-list').innerHTML = '';
    document.getElementById('store-list').innerHTML = '';
    document.getElementById('page-profile').querySelector('.card-list').innerHTML = '';

    // Remove FAQ section from DOM entirely per requirements (if it existed)
    const faqContainer = document.getElementById('modal-faq-container');
    if (faqContainer) faqContainer.remove();

    // --- Render Functions (Ready for Dynamic Data Injection) ---
    function renderApps(apps) {
        const homeList = document.getElementById('home-list');
        const noResults = document.getElementById('home-no-results');
        
        homeList.innerHTML = ''; // Clean before injecting new data
        
        apps.forEach(app => {
            const el = document.createElement('a');
            el.href = app.targetLink || '#';
            el.className = 'item-card glass app-item';
            el.dataset.category = (app.category || 'popular').trim().toLowerCase();
            el.dataset.name = (app.title || 'App').toLowerCase();
            el.style.textDecoration = 'none';
            el.style.color = 'inherit';
            
            el.innerHTML = `
                <img src="${app.imageUrl || ''}" class="item-icon" alt="${app.title}">
                <div class="item-info">
                    <div class="item-title">${app.title}</div>
                    <div class="item-date">Updated: ${app.updateDate || ''}</div>
                </div>
                <div class="item-action">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                        <polyline points="7 10 12 15 17 10"></polyline>
                        <line x1="12" y1="15" x2="12" y2="3"></line>
                    </svg>
                </div>
            `;
            homeList.appendChild(el);
        });

        if (noResults) homeList.appendChild(noResults);
        
        triggerFilter(searchInput.value.toLowerCase());
        const activeFilter = document.querySelector('.filter-tag.active')?.dataset.cat || 'All';
        selectFilter(activeFilter);
    }

    window.openProductModal = function(product) {
        document.getElementById('modal-img').src = product.imageUrl || '';
        document.getElementById('modal-title').textContent = product.name || '';
        
        const pricesContainer = document.getElementById('modal-prices');
        pricesContainer.innerHTML = '<h4 style="color: var(--text-muted); font-size: 0.85rem; margin-top: 10px; margin-bottom: 5px; text-transform: uppercase;">LIST HARGA</h4>' + 
            '<ul style="text-align: left; padding-left: 20px; font-weight: normal; color: var(--text-main); font-size: 0.95rem; line-height: 1.6;">' + 
            (product.priceList || []).map(p => `<li>${p}</li>`).join('') + 
            '</ul>';
        
        document.getElementById('modal-desc').textContent = product.description || '';
        
        const waBtn = document.getElementById('modal-wa-btn');
        if(waBtn) waBtn.href = product.whatsappLink || '#';

        modal.classList.add('show');
    };

    function renderProducts(products) {
        const storeList = document.getElementById('store-list');
        const noResults = document.getElementById('store-no-results');
        
        storeList.innerHTML = '';
        
        products.forEach(product => {
            const el = document.createElement('div');
            el.className = 'item-card glass store-item';
            el.dataset.name = product.name;
            el.onclick = () => window.openProductModal(product);
            
            el.innerHTML = `
                <img src="${product.imageUrl || ''}" class="item-icon" alt="${product.name}">
                <div class="item-info">
                    <div class="item-title">${product.name}</div>
                    <div class="item-date">Premium</div>
                </div>
                <div class="item-action">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <circle cx="9" cy="21" r="1"></circle>
                        <circle cx="20" cy="21" r="1"></circle>
                        <path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"></path>
                    </svg>
                </div>
            `;
            storeList.appendChild(el);
        });
        
        if (noResults) storeList.appendChild(noResults);
        triggerFilter(searchInput.value.toLowerCase());
    }

    function renderSocials(socials) {
    const profilePage = document.getElementById('page-profile');
    const cardList = profilePage.querySelector('.card-list');
    cardList.innerHTML = '';
    
    socials
      .filter(s => s.isActive)
      .sort((a, b) => (a.order || 0) - (b.order || 0))
      .forEach(social => {
        const el = document.createElement('a');
        el.href = social.targetLink || '#';
        el.className = 'social-btn glass';
        el.target = '_blank';

        el.innerHTML = `
            <img src="${social.imageUrl || ''}" 
                 style="width:24px;height:24px;border-radius:6px;">
            <span>${social.name} ${social.username || ''}</span>
        `;

        cardList.appendChild(el);
    });
}

    // --- Theme Toggle Logic ---
    const sunSvg = `<circle cx="12" cy="12" r="5"></circle><line x1="12" y1="1" x2="12" y2="3"></line><line x1="12" y1="21" x2="12" y2="23"></line><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line><line x1="1" y1="12" x2="3" y2="12"></line><line x1="21" y1="12" x2="23" y2="12"></line><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>`;
    const moonSvg = `<path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path><path d="M3 3l1 2 2 1-2 1-1 2-1-2-2-1 2-1z" fill="currentColor"/>`;

    themeBtn.addEventListener('click', () => {
        const isDark = htmlTag.getAttribute('data-theme') === 'dark';
        if (isDark) {
            htmlTag.setAttribute('data-theme', 'light');
            themeIcon.innerHTML = sunSvg;
        } else {
            htmlTag.setAttribute('data-theme', 'dark');
            themeIcon.innerHTML = moonSvg;
        }
    });

    // --- Navigation & Indicator Logic ---
function updateIndicator(btn) {
    if (!btn || mainNav.classList.contains('nav-search-active')) {
        navIndicator.style.opacity = '0';
        return;
    }

    const navRect = mainNav.getBoundingClientRect();
    const btnRect = btn.getBoundingClientRect();

    const width = 72;
    const left =
        (btnRect.left - navRect.left) +
        (btnRect.width / 2) -
        (width / 2);

    navIndicator.style.width = `${width}px`;
    navIndicator.style.left = `${left}px`;
    navIndicator.style.opacity = '1';
}

    navBtns.forEach(btn => {
        btn.addEventListener('click', () => {
            navBtns.forEach(b => b.classList.remove('active'));
            pages.forEach(p => p.classList.remove('active'));
            
            btn.classList.add('active');
            document.getElementById(btn.dataset.target).classList.add('active');
            
            updateIndicator(btn);
            
            if (mainNav.classList.contains('nav-search-active')) {
                closeSearch();
            }
        });
    });

    window.addEventListener('load', () => {
        const activeBtn = document.querySelector('.nav-btn.active[data-target]');
        setTimeout(() => updateIndicator(activeBtn), 100);
        buildFilters();
    });
    
    window.addEventListener('resize', () => {
        const activeBtn = document.querySelector('.nav-btn.active[data-target]');
        updateIndicator(activeBtn);
    });


// --- Search Logic ---
    searchTrigger.addEventListener('click', (e) => {
        e.stopPropagation();
        if (mainNav.classList.contains('nav-search-active')) return; // Prevent re-triggering
        mainNav.classList.add('nav-search-active');
        updateIndicator(null);
        setTimeout(() => searchInput.focus(), 300);
    });

    function closeSearch() {
        if (!mainNav.classList.contains('nav-search-active')) return;
        mainNav.classList.remove('nav-search-active');
        searchInput.value = '';
        triggerFilter('');
        searchInput.blur();
        
        // Wait exactly 400ms for flex layout to finish snapping back to normal
        // BEFORE attempting to recalculate the blue indicator's left coordinate.
        setTimeout(() => {
            const activeBtn = document.querySelector('.nav-btn.active[data-target]');
            updateIndicator(activeBtn);
        }, 400); 
    }

    searchClose.addEventListener('touchstart', (e) => {
        e.preventDefault(); e.stopPropagation(); closeSearch();
    }, {passive: false});

    searchClose.addEventListener('mousedown', (e) => {
        e.preventDefault(); e.stopPropagation(); closeSearch();
    });

    searchClose.addEventListener('click', (e) => {
        e.preventDefault(); e.stopPropagation(); closeSearch();
    });

    document.addEventListener('click', (e) => {
        if (mainNav.classList.contains('nav-search-active') && !searchWrapper.contains(e.target)) {
            closeSearch();
        }
    });

    searchWrapper.addEventListener('click', (e) => {
        e.stopPropagation();
    });

    searchInput.addEventListener('input', (e) => {
        triggerFilter(e.target.value.toLowerCase());
    });

    function triggerFilter(query) {
        let homeVisible = 0;
        const homeItems = document.querySelectorAll('.app-item');
        homeItems.forEach(item => {
            const name = item.dataset.name.toLowerCase();
            if(name.includes(query)) {
                item.style.display = 'flex';
                homeVisible++;
            } else {
                item.style.display = 'none';
            }
        });
        const hNoRes = document.getElementById('home-no-results');
        if (hNoRes) hNoRes.style.display = (homeVisible === 0 && homeItems.length > 0) ? 'block' : 'none';

        let storeVisible = 0;
        const storeItems = document.querySelectorAll('.store-item');
        storeItems.forEach(item => {
            const name = item.dataset.name.toLowerCase();
            if(name.includes(query)) {
                item.style.display = 'flex';
                storeVisible++;
            } else {
                item.style.display = 'none';
            }
        });
        const sNoRes = document.getElementById('store-no-results');
        if (sNoRes) sNoRes.style.display = (storeVisible === 0 && storeItems.length > 0) ? 'block' : 'none';
    }

    // --- Moving Filter Logic ---
    let isDraggingFilter = false;
    let filterPauseTimer;

    function buildFilters() {
        const arr = ['All', ...filterCategories];
        const fullArr = [...arr, ...arr]; 
        
        fullArr.forEach(cat => {
            const btn = document.createElement('div');
            btn.className = `filter-tag ${cat === 'All' ? 'active' : ''}`;
            btn.textContent = cat;
            btn.dataset.cat = cat;
            btn.addEventListener('click', () => {
                selectFilter(cat);
                pauseFilterAutoScroll();
                resumeFilterAutoScroll();
            });
            filterTrack.appendChild(btn);
        });

        requestAnimationFrame(autoScrollFilter);
    }

    function autoScrollFilter() {
        if (!isDraggingFilter && filterContainer) {
            filterContainer.scrollLeft += 0.8; 
            if (filterContainer.scrollLeft >= filterTrack.scrollWidth / 2) {
                filterContainer.scrollLeft = 0; 
            }
        }
        requestAnimationFrame(autoScrollFilter);
    }

    function pauseFilterAutoScroll() {
        isDraggingFilter = true;
        clearTimeout(filterPauseTimer);
    }

    function resumeFilterAutoScroll() {
        clearTimeout(filterPauseTimer);
        filterPauseTimer = setTimeout(() => {
            isDraggingFilter = false;
        }, 1000);
    }

    if(filterContainer) {
        filterContainer.addEventListener('touchstart', pauseFilterAutoScroll, {passive: true});
        filterContainer.addEventListener('mousedown', pauseFilterAutoScroll);
        filterContainer.addEventListener('touchend', resumeFilterAutoScroll);
        filterContainer.addEventListener('mouseup', resumeFilterAutoScroll);
        filterContainer.addEventListener('mouseleave', resumeFilterAutoScroll);
        filterContainer.addEventListener('wheel', pauseFilterAutoScroll, {passive: true});
    }

    function selectFilter(category) {
        const cat = category.toLowerCase();

        document.querySelectorAll('.filter-tag').forEach(t => {
            t.classList.toggle('active', t.dataset.cat.toLowerCase() === category.toLowerCase());
        });

        let visibleCount = 0;
        document.querySelectorAll('.app-item').forEach(item => {
            if (cat === 'all' || item.dataset.category === cat) {
                item.style.display = 'flex';
                visibleCount++;
            } else {
                item.style.display = 'none';
            }
        });

        const hNoRes = document.getElementById('home-no-results');
        if (hNoRes) hNoRes.style.display = visibleCount === 0 ? 'block' : 'none';
    }

    // --- Modal Logic ---
    closeModalBtn.addEventListener('click', () => {
        modal.classList.remove('show');
    });

    modal.addEventListener('click', (e) => {
        if (e.target === modal) {
            modal.classList.remove('show');
        }
    });

// --- COMMAND-BASED MUSIC SYSTEM LOGIC ---
// Append this block inside the existing <script type="module">, preferably at the bottom.

const audioElem = new Audio();
const dynamicIsland = document.getElementById('dynamic-island');
const diPlayPause = document.getElementById('di-play-pause');
const diIconPlay = document.getElementById('di-icon-play');
const diIconPause = document.getElementById('di-icon-pause');
const diVisualizer = document.getElementById('di-visualizer');

// Search elements (re-selecting to ensure scope access if needed, or using existing)
const musicSearchInput = document.getElementById('search-input');
const musicSearchTrigger = document.getElementById('search-trigger');
const musicMainNav = document.getElementById('main-nav');
const musicSearchClose = document.getElementById('search-close');

// Toggle Play/Pause UI and Audio
function toggleMusicPlayPause() {
    if (!audioElem.src) return;
    
    if (audioElem.paused) {
        audioElem.play();
        diIconPlay.style.display = 'none';
        diIconPause.style.display = 'block';
        diVisualizer.classList.remove('paused');
    } else {
        audioElem.pause();
        diIconPlay.style.display = 'block';
        diIconPause.style.display = 'none';
        diVisualizer.classList.add('paused');
    }
}

diPlayPause.addEventListener('click', toggleMusicPlayPause);

// Automatically hide UI if music naturally finishes
audioElem.addEventListener('ended', () => {
    dynamicIsland.classList.remove('active');
    diVisualizer.classList.add('paused');
});

// Command Parser Execution
function executeMusicCommand(command) {
    const cmd = command.trim().toLowerCase();
    
    if (cmd === '/music1') {
        audioElem.src = 'music1.mp3';
        audioElem.play().then(() => {
            dynamicIsland.classList.add('active');
            diIconPlay.style.display = 'none';
            diIconPause.style.display = 'block';
            diVisualizer.classList.remove('paused');
        }).catch(err => console.log("Audio playback failed (check path):", err));
        return true;
    } 
    else if (cmd === '/stopmusic') {
        audioElem.pause();
        audioElem.currentTime = 0;
        audioElem.src = '';
        dynamicIsland.classList.remove('active');
        diVisualizer.classList.add('paused');
        return true;
    }
    
    return false;
}

// Function to safely close the search bar without modifying original closeSearch()
function triggerExistingSearchClose() {
    musicSearchClose.click(); 
}

// Listener 1: Enter key in search input
musicSearchInput.addEventListener('keydown', (e) => {
    if (e.key === 'Enter') {
        if (executeMusicCommand(musicSearchInput.value)) {
            triggerExistingSearchClose();
        }
    }
});

// Listener 2: Clicking the search (magnifier) icon while search is active
musicSearchTrigger.addEventListener('click', (e) => {
    if (musicMainNav.classList.contains('nav-search-active')) {
        if (executeMusicCommand(musicSearchInput.value)) {
            triggerExistingSearchClose();
        }
    }
});

</script>
</body>
</html>
